(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{CgF7:function(e,t,s){"use strict";s.r(t),s.d(t,"ChatModule",function(){return $});var i=s("ofXK"),c=s("tyNb"),n=s("3Pt+"),a=s("0IaG"),o=s("AytR"),r=s("fXoL");let l=(()=>{class e{constructor(e){this.image=e,this.imagePath=`${o.a.baseUrl}/${e}`}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(a.a))},e.\u0275cmp=r.Jb({type:e,selectors:[["app-image-dialog"]],decls:2,vars:1,consts:[["mat-dialog-content",""],["alt","",1,"img-fluid","w-100",3,"src"]],template:function(e,t){1&e&&(r.Vb(0,"div",0),r.Qb(1,"img",1),r.Ub()),2&e&&(r.Cb(1),r.qc("src",t.imagePath,r.Hc))},directives:[a.e],styles:[""]}),e})();var b=s("7dP1"),d=s("f4AX"),g=s("tk/3");let m=(()=>{class e{constructor(e){this.httpClient=e}getMessages(e){return this.httpClient.get(`${o.a.apiUrl}/mensajes/${e}`)}}return e.\u0275fac=function(t){return new(t||e)(r.cc(g.b))},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var u=s("Ea0c"),f=s("Wp6s"),p=s("MutI"),h=s("bv9b"),v=s("FKr1"),U=s("vxfF"),I=s("bTqV"),C=s("NFeN"),V=s("kmnG"),y=s("qFsG");function M(e,t){1&e&&r.Qb(0,"mat-progress-bar",9)}function k(e,t){if(1&e){const e=r.Wb();r.Vb(0,"mat-list-option",10),r.fc("click",function(){r.Fc(e);const s=t.$implicit;return r.jc().selectUser(s)}),r.Qb(1,"div",11),r.Vb(2,"div",12),r.Qc(3),r.Ub(),r.Vb(4,"div",12),r.Qc(5),r.Ub(),r.Ub()}if(2&e){const e=t.$implicit;r.Cb(3),r.Rc(e.nombres),r.Cb(2),r.Rc(e.telefono)}}function w(e,t){1&e&&r.Qb(0,"div",13)}function O(e,t){1&e&&r.Qb(0,"mat-progress-bar",9)}function P(e,t){if(1&e&&(r.Vb(0,"div"),r.Qc(1),r.Ub()),2&e){const e=r.jc().$implicit;r.Cb(1),r.Rc(e.texto)}}function q(e,t){if(1&e){const e=r.Wb();r.Vb(0,"button",32),r.fc("click",function(){r.Fc(e);const t=r.jc().$implicit;return r.jc(2).openImage(t.image)}),r.Vb(1,"mat-icon"),r.Qc(2,"collections"),r.Ub(),r.Ub()}}function F(e,t){if(1&e&&(r.Vb(0,"mat-list-item",30),r.Oc(1,P,2,1,"div",8),r.Oc(2,q,3,0,"button",31),r.Ub()),2&e){const e=t.$implicit,s=r.jc(2);r.Eb(s.getMessageClass(e)+" item"),r.Cb(1),r.qc("ngIf",e.texto),r.Cb(1),r.qc("ngIf",e.image)}}function Q(e,t){1&e&&r.Qb(0,"div",33)}function x(e,t){if(1&e){const e=r.Wb();r.Vb(0,"mat-card"),r.Vb(1,"mat-card-header",14),r.Qb(2,"div",15),r.Vb(3,"mat-card-title"),r.Qc(4),r.Ub(),r.Vb(5,"mat-card-subtitle",16),r.Qc(6),r.Ub(),r.Ub(),r.Vb(7,"mat-card-content",17),r.Vb(8,"mat-list",18),r.Oc(9,O,1,0,"mat-progress-bar",3),r.Vb(10,"cdk-virtual-scroll-viewport",19),r.Oc(11,F,3,4,"mat-list-item",20),r.Oc(12,Q,1,0,"div",21),r.Ub(),r.Ub(),r.Ub(),r.Vb(13,"mat-card-actions",22),r.Vb(14,"input",23,24),r.fc("change",function(t){return r.Fc(e),r.jc().onImageSelected(t)}),r.Ub(),r.Vb(16,"button",25),r.fc("click",function(){return r.Fc(e),r.Dc(15).click()}),r.Vb(17,"mat-icon"),r.Qc(18,"attach_file"),r.Ub(),r.Ub(),r.Vb(19,"form",26),r.fc("ngSubmit",function(t){return r.Fc(e),r.jc().sendMessage(t)}),r.Vb(20,"mat-form-field",27),r.Vb(21,"mat-label"),r.Qc(22,"Mensaje"),r.Ub(),r.Qb(23,"input",28),r.Ub(),r.Vb(24,"button",29),r.Vb(25,"mat-icon"),r.Qc(26,"send"),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.jc();r.Cb(4),r.Rc(e.selectedUser.nombres+" "+e.selectedUser.apellidos),r.Cb(2),r.Rc(e.selectedUser.telefono),r.Cb(3),r.qc("ngIf",e.isLoadingMessages),r.Cb(2),r.qc("cdkVirtualForOf",e.messages),r.Cb(1),r.qc("ngIf",e.isLoadingMessages),r.Cb(7),r.qc("formGroup",e.form)}}const L=[{path:"",component:(()=>{class e{constructor(e,t,s,i,c,n){this.formBuilder=e,this.authService=t,this.userService=s,this.messageService=i,this.socketService=c,this.dialog=n,this.messages=[],this.isLoadingUsers=!1,this.isLoadingMessages=!1,this.buildForm(),this.loggedIn=this.authService.loggedIn}ngOnInit(){this.isLoadingUsers=!0,("doctor"===this.loggedIn.roles[0]?this.userService.getPatientsByDoctorId(this.loggedIn._id):this.userService.getDoctorsByPatientId(this.loggedIn._id)).subscribe(e=>{this.users=e,this.isLoadingUsers=!1}),this.socketService.listen("sendMessage").subscribe(e=>{this.messages=[...this.messages,e]})}buildForm(){this.form=this.formBuilder.group({message:["",[n.t.required,n.t.maxLength(100)]]})}selectUser(e){this.isLoadingMessages=!0,this.selectedUser=e,this.getMessages(this.selectedUser._id)}getMessages(e){this.messageService.getMessages(e).subscribe(e=>{this.messages=e.messages,this.isLoadingMessages=!1})}sendMessage(e){if(e.preventDefault(),this.form.valid){const{message:e}=this.form.value,{_id:t}=this.selectedUser;this.socketService.emit("sendMessage",{receiver:t,texto:e}),this.form.patchValue({message:""})}}getMessageClass(e){return"paciente"===this.loggedIn.roles[0]?1===e.dir?"bg-primary":"bg-accent d-flex justify-content-end":0===e.dir?"bg-primary":"bg-accent d-flex justify-content-end"}onImageSelected(e){const t=e.target;t.files&&t.files[0]&&this.uploadImage(t.files[0])}uploadImage(e){const{_id:t}=this.selectedUser,s=new FileReader;s.onload=e=>{const s={receiver:t,image:e.target.result.toString()};this.socketService.emit("sendMessage",s)},s.readAsDataURL(e)}openImage(e){this.dialog.open(l,{data:e})}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(n.e),r.Pb(b.a),r.Pb(d.a),r.Pb(m),r.Pb(u.a),r.Pb(a.b))},e.\u0275cmp=r.Jb({type:e,selectors:[["app-chat"]],decls:13,vars:5,consts:[[1,"row"],[1,"col-md-4"],[2,"height","394.56px"],["mode","indeterminate",4,"ngIf"],[1,"pt-0",3,"multiple"],[3,"click",4,"ngFor","ngForOf"],["class","users-loading-shade",4,"ngIf"],[1,"col-md-8"],[4,"ngIf"],["mode","indeterminate"],[3,"click"],["mat-list-icon","",1,"dot"],["mat-line",""],[1,"users-loading-shade"],[1,"mb-2"],["mat-card-avatar","",1,"header-image"],[1,"mb-0"],[1,"w-100","mb-0"],["role","list"],["itemSize","50",1,"viewport","w-100"],["role","listitem",3,"class",4,"cdkVirtualFor","cdkVirtualForOf"],["class","messages-loading-shade",4,"ngIf"],[1,"d-flex","w-100","px-2"],["type","file",1,"d-none",3,"change"],["imageInput",""],["mat-icon-button","","color","primary",1,"my-auto","mr-1",3,"click"],[1,"d-flex","w-100",3,"formGroup","ngSubmit"],[1,"w-100","mr-3"],["type","text","autocomplete","off","matInput","","placeholder","Ej. It makes me feel...","formControlName","message"],["type","submit","mat-mini-fab","","color","primary",1,"my-auto"],["role","listitem"],["mat-mini-fab","","color","warn",3,"click",4,"ngIf"],["mat-mini-fab","","color","warn",3,"click"],[1,"messages-loading-shade"]],template:function(e,t){1&e&&(r.Vb(0,"h1"),r.Qc(1,"Chat"),r.Ub(),r.Vb(2,"p"),r.Qc(3," Lorem ipsum dolor sit, amet consectetur adipisicing elit. A tempora nostrum error dolore sequi pariatur, eligendi voluptatem enim et suscipit. Repellendus sint quam, similique quos laboriosam hic maiores porro corporis.\n"),r.Ub(),r.Vb(4,"div",0),r.Vb(5,"div",1),r.Vb(6,"mat-card",2),r.Oc(7,M,1,0,"mat-progress-bar",3),r.Vb(8,"mat-selection-list",4),r.Oc(9,k,6,2,"mat-list-option",5),r.Ub(),r.Oc(10,w,1,0,"div",6),r.Ub(),r.Ub(),r.Vb(11,"div",7),r.Oc(12,x,27,6,"mat-card",8),r.Ub(),r.Ub()),2&e&&(r.Cb(7),r.qc("ngIf",t.isLoadingUsers),r.Cb(1),r.qc("multiple",!1),r.Cb(1),r.qc("ngForOf",t.users),r.Cb(1),r.qc("ngIf",t.isLoadingMessages),r.Cb(2),r.qc("ngIf",t.selectedUser))},directives:[f.a,i.m,p.g,i.l,h.a,p.e,p.b,v.i,f.e,f.c,f.i,f.h,f.d,p.a,U.e,U.a,U.d,f.b,I.b,C.a,n.v,n.n,n.h,V.b,V.e,y.b,n.c,n.m,n.g,p.c],styles:[".dot[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%}.dot[_ngcontent-%COMP%], .header-image[_ngcontent-%COMP%]{background-image:url(/assets/img/user.png);background-size:cover}.viewport[_ngcontent-%COMP%]{height:250px}.item[_ngcontent-%COMP%]{height:50px}.messages-loading-shade[_ngcontent-%COMP%], .users-loading-shade[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;right:0;background:#fff;opacity:.5;z-index:1;display:flex;align-items:center;justify-content:center}"]}),e})()}];let S=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},imports:[[c.c.forChild(L)],c.c]}),e})();var j=s("hctd");let $=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},imports:[[i.c,S,j.a,n.s]]}),e})()},f4AX:function(e,t,s){"use strict";s.d(t,"a",function(){return a});var i=s("AytR"),c=s("fXoL"),n=s("tk/3");let a=(()=>{class e{constructor(e){this.httpClient=e}getPatientsByDoctorId(e){return this.httpClient.get(`${i.a.apiUrl}/pacientes/${e}`)}getDoctorsByPatientId(e){return this.httpClient.get(`${i.a.apiUrl}/doctores/${e}`)}}return e.\u0275fac=function(t){return new(t||e)(c.cc(n.b))},e.\u0275prov=c.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);