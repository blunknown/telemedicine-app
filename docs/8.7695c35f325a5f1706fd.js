(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{CgF7:function(t,e,s){"use strict";s.r(e),s.d(e,"ChatModule",function(){return G});var i=s("ofXK"),a=s("tyNb"),n=s("vxfF"),c=s("3Pt+"),o=s("0IaG"),r=s("AytR"),g=s("fXoL");let l=(()=>{class t{constructor(t){this.image=t,this.imagePath=`${r.a.baseUrl}/${t}`}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(g.Pb(o.a))},t.\u0275cmp=g.Jb({type:t,selectors:[["app-image-dialog"]],decls:2,vars:1,consts:[["mat-dialog-content",""],["alt","",1,"img-fluid","w-100",3,"src"]],template:function(t,e){1&t&&(g.Vb(0,"div",0),g.Qb(1,"img",1),g.Ub()),2&t&&(g.Cb(1),g.qc("src",e.imagePath,g.Hc))},directives:[o.e],styles:[""]}),t})();var d=s("7dP1"),m=s("f4AX"),b=s("tk/3");let u=(()=>{class t{constructor(t){this.httpClient=t}getMessages(t){return this.httpClient.get(`${r.a.apiUrl}/mensajes/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(g.cc(b.b))},t.\u0275prov=g.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=s("Ea0c"),p=s("Wp6s"),h=s("MutI"),v=s("bv9b"),U=s("FKr1"),I=s("bTqV"),C=s("NFeN"),V=s("kmnG"),y=s("qFsG");const w=["gg"];function O(t,e){1&t&&(g.Vb(0,"p"),g.Qc(1," A continuaci\xf3n podr\xe1 visualizar los pacientes que tiene a cargo a quienes les puede enviar mensajes.\n"),g.Ub())}function M(t,e){1&t&&(g.Vb(0,"p"),g.Qc(1," A continuaci\xf3n podr\xe1 visualizar sus doctores asignados a quienes les puede enviar mensajes.\n"),g.Ub())}function k(t,e){1&t&&g.Qb(0,"mat-progress-bar",10)}function q(t,e){1&t&&g.Qb(0,"img",15)}function P(t,e){1&t&&g.Qb(0,"img",16)}function x(t,e){if(1&t){const t=g.Wb();g.Vb(0,"mat-list-option",11),g.fc("click",function(){g.Fc(t);const s=e.$implicit;return g.jc().selectUser(s)}),g.Oc(1,q,1,0,"img",12),g.Oc(2,P,1,0,"img",13),g.Vb(3,"div",14),g.Qc(4),g.Ub(),g.Ub()}if(2&t){const t=e.$implicit,s=g.jc();g.Cb(1),g.qc("ngIf","doctor"===s.loggedIn.roles[0]),g.Cb(1),g.qc("ngIf","paciente"===s.loggedIn.roles[0]),g.Cb(2),g.Rc(t.nombres)}}function Q(t,e){1&t&&g.Qb(0,"div",17)}function j(t,e){1&t&&g.Qb(0,"img",35)}function A(t,e){1&t&&g.Qb(0,"img",36)}function F(t,e){1&t&&g.Qb(0,"mat-progress-bar",10)}function _(t,e){if(1&t&&(g.Vb(0,"div"),g.Qc(1),g.Ub()),2&t){const t=g.jc().$implicit;g.Cb(1),g.Rc(t.texto)}}function L(t,e){if(1&t){const t=g.Wb();g.Vb(0,"button",39),g.fc("click",function(){g.Fc(t);const e=g.jc().$implicit;return g.jc(2).openImage(e.image)}),g.Vb(1,"mat-icon"),g.Qc(2,"collections"),g.Ub(),g.Ub()}}function S(t,e){if(1&t&&(g.Vb(0,"mat-list-item",37),g.Oc(1,_,2,1,"div",0),g.Oc(2,L,3,0,"button",38),g.Ub()),2&t){const t=e.$implicit,s=g.jc(2);g.Eb(s.getMessageClass(t)+" item"),g.Cb(1),g.qc("ngIf",t.texto),g.Cb(1),g.qc("ngIf",t.image)}}function $(t,e){1&t&&g.Qb(0,"div",40)}function R(t,e){if(1&t){const t=g.Wb();g.Vb(0,"mat-card"),g.Vb(1,"mat-card-header",18),g.Oc(2,j,1,0,"img",19),g.Oc(3,A,1,0,"img",20),g.Vb(4,"mat-card-title"),g.Qc(5),g.Ub(),g.Vb(6,"mat-card-subtitle",21),g.Qc(7),g.Ub(),g.Ub(),g.Vb(8,"mat-card-content",22),g.Vb(9,"mat-list",23),g.Oc(10,F,1,0,"mat-progress-bar",4),g.Vb(11,"cdk-virtual-scroll-viewport",24),g.Oc(12,S,3,4,"mat-list-item",25),g.Oc(13,$,1,0,"div",26),g.Ub(),g.Ub(),g.Ub(),g.Vb(14,"mat-card-actions",27),g.Vb(15,"input",28,29),g.fc("change",function(e){return g.Fc(t),g.jc().onImageSelected(e)}),g.Ub(),g.Vb(17,"button",30),g.fc("click",function(){return g.Fc(t),g.Dc(16).click()}),g.Vb(18,"mat-icon"),g.Qc(19,"attach_file"),g.Ub(),g.Ub(),g.Vb(20,"form",31),g.fc("ngSubmit",function(e){return g.Fc(t),g.jc().sendMessage(e)}),g.Vb(21,"mat-form-field",32),g.Vb(22,"mat-label"),g.Qc(23,"Mensaje"),g.Ub(),g.Qb(24,"input",33),g.Ub(),g.Vb(25,"button",34),g.Vb(26,"mat-icon"),g.Qc(27,"send"),g.Ub(),g.Ub(),g.Ub(),g.Ub(),g.Ub()}if(2&t){const t=g.jc();g.Cb(2),g.qc("ngIf","doctor"===t.loggedIn.roles[0]),g.Cb(1),g.qc("ngIf","paciente"===t.loggedIn.roles[0]),g.Cb(2),g.Rc(t.selectedUser.nombres+" "+t.selectedUser.apellidos),g.Cb(2),g.Rc(t.selectedUser.telefono),g.Cb(3),g.qc("ngIf",t.isLoadingMessages),g.Cb(2),g.qc("cdkVirtualForOf",t.messages),g.Cb(1),g.qc("ngIf",t.isLoadingMessages),g.Cb(7),g.qc("formGroup",t.form)}}const N=[{path:"",component:(()=>{class t{constructor(t,e,s,i,a,n){this.formBuilder=t,this.authService=e,this.userService=s,this.messageService=i,this.socketService=a,this.dialog=n,this.messages=[],this.isLoadingUsers=!1,this.isLoadingMessages=!1,this.notification=!0,this.buildForm(),this.loggedIn=this.authService.loggedIn}ngOnInit(){this.isLoadingUsers=!0,("doctor"===this.loggedIn.roles[0]?this.userService.getPatientsByDoctorId(this.loggedIn._id):this.userService.getDoctorsByPatientId(this.loggedIn._id)).subscribe(t=>{this.users=t,this.isLoadingUsers=!1}),this.socketService.listen("sendMessage").subscribe(t=>{this.messages=[...this.messages,t],this.notification&&new Audio("assets/notification.mp3").play(),setTimeout(()=>{this.viewport.scrollToIndex(this.messages.length)},0),this.notification=!0})}buildForm(){this.form=this.formBuilder.group({message:["",[c.t.required,c.t.maxLength(100)]]})}selectUser(t){this.isLoadingMessages=!0,this.selectedUser=t,this.getMessages(this.selectedUser._id)}getMessages(t){this.messageService.getMessages(t).subscribe(t=>{this.messages=t.messages,this.isLoadingMessages=!1,setTimeout(()=>{this.viewport.scrollToIndex(this.messages.length)},0)})}sendMessage(t){if(t.preventDefault(),this.form.valid){const{message:t}=this.form.value,{_id:e}=this.selectedUser,s={receiver:e,texto:t};this.notification=!1,this.socketService.emit("sendMessage",s),this.form.patchValue({message:""})}}getMessageClass(t){return"paciente"===this.loggedIn.roles[0]?1===t.dir?"bg-primary":"bg-accent d-flex justify-content-end":0===t.dir?"bg-primary":"bg-accent d-flex justify-content-end"}onImageSelected(t){const e=t.target;e.files&&e.files[0]&&this.uploadImage(e.files[0])}uploadImage(t){const{_id:e}=this.selectedUser,s=new FileReader;s.onload=t=>{const s={receiver:e,image:t.target.result.toString()};this.socketService.emit("sendMessage",s)},s.readAsDataURL(t)}openImage(t){this.dialog.open(l,{data:t})}}return t.\u0275fac=function(e){return new(e||t)(g.Pb(c.e),g.Pb(d.a),g.Pb(m.a),g.Pb(u),g.Pb(f.a),g.Pb(o.b))},t.\u0275cmp=g.Jb({type:t,selectors:[["app-chat"]],viewQuery:function(t,e){if(1&t&&(g.Uc(n.e,!0),g.Uc(w,!0)),2&t){let t;g.Cc(t=g.gc())&&(e.viewport=t.first),g.Cc(t=g.gc())&&(e.gg=t.first)}},decls:14,vars:7,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-4"],[1,"list",2,"height","394.56px"],["mode","indeterminate",4,"ngIf"],[1,"pt-0",3,"multiple"],["gg",""],[3,"click",4,"ngFor","ngForOf"],["class","users-loading-shade",4,"ngIf"],[1,"col-md-8"],["mode","indeterminate"],[3,"click"],["src","assets/img/user.png","alt","Avatar","class","avatar","mat-list-icon","",4,"ngIf"],["src","assets/img/doctor.png","alt","Avatar","class","avatar","mat-list-icon","",4,"ngIf"],["mat-line",""],["src","assets/img/user.png","alt","Avatar","mat-list-icon","",1,"avatar"],["src","assets/img/doctor.png","alt","Avatar","mat-list-icon","",1,"avatar"],[1,"users-loading-shade"],[1,"mb-2"],["src","assets/img/user.png","alt","Avatar","class","avatar-chat","mat-card-avatar","",4,"ngIf"],["src","assets/img/doctor.png","alt","Avatar","class","avatar-chat","mat-card-avatar","",4,"ngIf"],[1,"mb-0"],[1,"w-100","mb-0"],["role","list"],["itemSize","50",1,"viewport","w-100"],["role","listitem",3,"class",4,"cdkVirtualFor","cdkVirtualForOf"],["class","messages-loading-shade",4,"ngIf"],[1,"d-flex","w-100","px-2"],["type","file",1,"d-none",3,"change"],["imageInput",""],["mat-icon-button","","color","primary",1,"my-auto","mr-1",3,"click"],[1,"d-flex","w-100",3,"formGroup","ngSubmit"],[1,"w-100","mr-3"],["autocomplete","off","matInput","","placeholder","Ej. It makes me feel...","formControlName","message"],["type","submit","mat-mini-fab","","color","primary",1,"my-auto"],["src","assets/img/user.png","alt","Avatar","mat-card-avatar","",1,"avatar-chat"],["src","assets/img/doctor.png","alt","Avatar","mat-card-avatar","",1,"avatar-chat"],["role","listitem"],["mat-mini-fab","","color","warn",3,"click",4,"ngIf"],["mat-mini-fab","","color","warn",3,"click"],[1,"messages-loading-shade"]],template:function(t,e){1&t&&(g.Vb(0,"h1"),g.Qc(1,"Chat"),g.Ub(),g.Oc(2,O,2,0,"p",0),g.Oc(3,M,2,0,"p",0),g.Vb(4,"div",1),g.Vb(5,"div",2),g.Vb(6,"mat-card",3),g.Oc(7,k,1,0,"mat-progress-bar",4),g.Vb(8,"mat-selection-list",5,6),g.Oc(10,x,5,3,"mat-list-option",7),g.Ub(),g.Oc(11,Q,1,0,"div",8),g.Ub(),g.Ub(),g.Vb(12,"div",9),g.Oc(13,R,28,8,"mat-card",0),g.Ub(),g.Ub()),2&t&&(g.Cb(2),g.qc("ngIf","doctor"===e.loggedIn.roles[0]),g.Cb(1),g.qc("ngIf","paciente"===e.loggedIn.roles[0]),g.Cb(4),g.qc("ngIf",e.isLoadingUsers),g.Cb(1),g.qc("multiple",!1),g.Cb(2),g.qc("ngForOf",e.users),g.Cb(1),g.qc("ngIf",e.isLoadingUsers),g.Cb(2),g.qc("ngIf",e.selectedUser))},directives:[i.m,p.a,h.g,i.l,v.a,h.e,U.i,h.b,p.e,p.i,p.h,p.d,h.a,n.e,n.a,n.d,p.b,I.a,C.a,c.v,c.n,c.h,V.b,V.e,y.b,c.c,c.m,c.g,p.c,h.c],styles:[".dot[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%}.dot[_ngcontent-%COMP%], .header-image[_ngcontent-%COMP%]{background-image:url(https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcRBLXh6UTPGZy1H9Oq_UUdhLqh06Ns-SbV6xQ&usqp=CAU);background-size:cover}.viewport[_ngcontent-%COMP%]{height:250px}.item[_ngcontent-%COMP%]{height:50px}.messages-loading-shade[_ngcontent-%COMP%], .users-loading-shade[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;right:0;background:#fff;opacity:.5;z-index:1;display:flex;align-items:center;justify-content:center}.list[_ngcontent-%COMP%]{overflow-y:auto}.avatar[_ngcontent-%COMP%]{width:40px!important;height:40px!important}.avatar[_ngcontent-%COMP%], .avatar-chat[_ngcontent-%COMP%]{vertical-align:middle;border-radius:50%}.avatar-chat[_ngcontent-%COMP%]{width:50px;height:50px}"]}),t})()}];let B=(()=>{class t{}return t.\u0275mod=g.Nb({type:t}),t.\u0275inj=g.Mb({factory:function(e){return new(e||t)},imports:[[a.d.forChild(N)],a.d]}),t})();var D=s("hctd");let G=(()=>{class t{}return t.\u0275mod=g.Nb({type:t}),t.\u0275inj=g.Mb({factory:function(e){return new(e||t)},imports:[[i.c,B,D.a,c.s]]}),t})()},f4AX:function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s("AytR"),a=s("fXoL"),n=s("tk/3");let c=(()=>{class t{constructor(t){this.httpClient=t}getPatientsByDoctorId(t){return this.httpClient.get(`${i.a.apiUrl}/pacientes/${t}`)}getDoctorsByPatientId(t){return this.httpClient.get(`${i.a.apiUrl}/doctores/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(a.cc(n.b))},t.\u0275prov=a.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);