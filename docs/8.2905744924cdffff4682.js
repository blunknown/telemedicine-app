(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{CgF7:function(t,e,s){"use strict";s.r(e),s.d(e,"ChatModule",function(){return D});var a=s("ofXK"),i=s("tyNb"),n=s("3Pt+"),c=s("0IaG"),r=s("AytR"),o=s("fXoL");let g=(()=>{class t{constructor(t){this.image=t,this.imagePath=`${r.a.baseUrl}/${t}`}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(c.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["app-image-dialog"]],decls:2,vars:1,consts:[["mat-dialog-content",""],["alt","",1,"img-fluid","w-100",3,"src"]],template:function(t,e){1&t&&(o.Vb(0,"div",0),o.Qb(1,"img",1),o.Ub()),2&t&&(o.Cb(1),o.qc("src",e.imagePath,o.Hc))},directives:[c.e],styles:[""]}),t})();var l=s("7dP1"),d=s("f4AX"),b=s("tk/3");let m=(()=>{class t{constructor(t){this.httpClient=t}getMessages(t){return this.httpClient.get(`${r.a.apiUrl}/mensajes/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(o.cc(b.b))},t.\u0275prov=o.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var u=s("Ea0c"),f=s("Wp6s"),p=s("MutI"),h=s("bv9b"),v=s("FKr1"),U=s("vxfF"),I=s("bTqV"),C=s("NFeN"),V=s("kmnG"),y=s("qFsG");function M(t,e){1&t&&(o.Vb(0,"p"),o.Qc(1," A continuaci\xf3n podr\xe1 visualizar los pacientes que tiene a cargo a quienes les puede enviar mensajes.\n"),o.Ub())}function O(t,e){1&t&&(o.Vb(0,"p"),o.Qc(1," A continuaci\xf3n podr\xe1 visualizar sus doctores asignados a quienes les puede enviar mensajes.\n"),o.Ub())}function w(t,e){1&t&&o.Qb(0,"mat-progress-bar",9)}function k(t,e){1&t&&o.Qb(0,"img",14)}function q(t,e){1&t&&o.Qb(0,"img",15)}function P(t,e){if(1&t){const t=o.Wb();o.Vb(0,"mat-list-option",10),o.fc("click",function(){o.Fc(t);const s=e.$implicit;return o.jc().selectUser(s)}),o.Oc(1,k,1,0,"img",11),o.Oc(2,q,1,0,"img",12),o.Vb(3,"div",13),o.Qc(4),o.Ub(),o.Ub()}if(2&t){const t=e.$implicit,s=o.jc();o.Cb(1),o.qc("ngIf","doctor"===s.loggedIn.roles[0]),o.Cb(1),o.qc("ngIf","paciente"===s.loggedIn.roles[0]),o.Cb(2),o.Rc(t.nombres)}}function x(t,e){1&t&&o.Qb(0,"div",16)}function Q(t,e){1&t&&o.Qb(0,"img",34)}function j(t,e){1&t&&o.Qb(0,"img",35)}function F(t,e){1&t&&o.Qb(0,"mat-progress-bar",9)}function _(t,e){if(1&t&&(o.Vb(0,"div"),o.Qc(1),o.Ub()),2&t){const t=o.jc().$implicit;o.Cb(1),o.Rc(t.texto)}}function A(t,e){if(1&t){const t=o.Wb();o.Vb(0,"button",38),o.fc("click",function(){o.Fc(t);const e=o.jc().$implicit;return o.jc(2).openImage(e.image)}),o.Vb(1,"mat-icon"),o.Qc(2,"collections"),o.Ub(),o.Ub()}}function L(t,e){if(1&t&&(o.Vb(0,"mat-list-item",36),o.Oc(1,_,2,1,"div",0),o.Oc(2,A,3,0,"button",37),o.Ub()),2&t){const t=e.$implicit,s=o.jc(2);o.Eb(s.getMessageClass(t)+" item"),o.Cb(1),o.qc("ngIf",t.texto),o.Cb(1),o.qc("ngIf",t.image)}}function S(t,e){1&t&&o.Qb(0,"div",39)}function $(t,e){if(1&t){const t=o.Wb();o.Vb(0,"mat-card"),o.Vb(1,"mat-card-header",17),o.Oc(2,Q,1,0,"img",18),o.Oc(3,j,1,0,"img",19),o.Vb(4,"mat-card-title"),o.Qc(5),o.Ub(),o.Vb(6,"mat-card-subtitle",20),o.Qc(7),o.Ub(),o.Ub(),o.Vb(8,"mat-card-content",21),o.Vb(9,"mat-list",22),o.Oc(10,F,1,0,"mat-progress-bar",4),o.Vb(11,"cdk-virtual-scroll-viewport",23),o.Oc(12,L,3,4,"mat-list-item",24),o.Oc(13,S,1,0,"div",25),o.Ub(),o.Ub(),o.Ub(),o.Vb(14,"mat-card-actions",26),o.Vb(15,"input",27,28),o.fc("change",function(e){return o.Fc(t),o.jc().onImageSelected(e)}),o.Ub(),o.Vb(17,"button",29),o.fc("click",function(){return o.Fc(t),o.Dc(16).click()}),o.Vb(18,"mat-icon"),o.Qc(19,"attach_file"),o.Ub(),o.Ub(),o.Vb(20,"form",30),o.fc("ngSubmit",function(e){return o.Fc(t),o.jc().sendMessage(e)}),o.Vb(21,"mat-form-field",31),o.Vb(22,"mat-label"),o.Qc(23,"Mensaje"),o.Ub(),o.Qb(24,"input",32),o.Ub(),o.Vb(25,"button",33),o.Vb(26,"mat-icon"),o.Qc(27,"send"),o.Ub(),o.Ub(),o.Ub(),o.Ub(),o.Ub()}if(2&t){const t=o.jc();o.Cb(2),o.qc("ngIf","doctor"===t.loggedIn.roles[0]),o.Cb(1),o.qc("ngIf","paciente"===t.loggedIn.roles[0]),o.Cb(2),o.Rc(t.selectedUser.nombres+" "+t.selectedUser.apellidos),o.Cb(2),o.Rc(t.selectedUser.telefono),o.Cb(3),o.qc("ngIf",t.isLoadingMessages),o.Cb(2),o.qc("cdkVirtualForOf",t.messages),o.Cb(1),o.qc("ngIf",t.isLoadingMessages),o.Cb(7),o.qc("formGroup",t.form)}}const R=[{path:"",component:(()=>{class t{constructor(t,e,s,a,i,n){this.formBuilder=t,this.authService=e,this.userService=s,this.messageService=a,this.socketService=i,this.dialog=n,this.messages=[],this.isLoadingUsers=!1,this.isLoadingMessages=!1,this.buildForm(),this.loggedIn=this.authService.loggedIn}ngOnInit(){this.isLoadingUsers=!0,("doctor"===this.loggedIn.roles[0]?this.userService.getPatientsByDoctorId(this.loggedIn._id):this.userService.getDoctorsByPatientId(this.loggedIn._id)).subscribe(t=>{this.users=t,this.isLoadingUsers=!1}),this.socketService.listen("sendMessage").subscribe(t=>{this.messages=[...this.messages,t]})}buildForm(){this.form=this.formBuilder.group({message:["",[n.t.required,n.t.maxLength(100)]]})}selectUser(t){this.isLoadingMessages=!0,this.selectedUser=t,this.getMessages(this.selectedUser._id)}getMessages(t){this.messageService.getMessages(t).subscribe(t=>{this.messages=t.messages,this.isLoadingMessages=!1})}sendMessage(t){if(t.preventDefault(),this.form.valid){const{message:t}=this.form.value,{_id:e}=this.selectedUser;this.socketService.emit("sendMessage",{receiver:e,texto:t}),this.form.patchValue({message:""})}}getMessageClass(t){return"paciente"===this.loggedIn.roles[0]?1===t.dir?"bg-primary":"bg-accent d-flex justify-content-end":0===t.dir?"bg-primary":"bg-accent d-flex justify-content-end"}onImageSelected(t){const e=t.target;e.files&&e.files[0]&&this.uploadImage(e.files[0])}uploadImage(t){const{_id:e}=this.selectedUser,s=new FileReader;s.onload=t=>{const s={receiver:e,image:t.target.result.toString()};this.socketService.emit("sendMessage",s)},s.readAsDataURL(t)}openImage(t){this.dialog.open(g,{data:t})}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(n.e),o.Pb(l.a),o.Pb(d.a),o.Pb(m),o.Pb(u.a),o.Pb(c.b))},t.\u0275cmp=o.Jb({type:t,selectors:[["app-chat"]],decls:13,vars:7,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-4"],[1,"list",2,"height","394.56px"],["mode","indeterminate",4,"ngIf"],[1,"pt-0",3,"multiple"],[3,"click",4,"ngFor","ngForOf"],["class","users-loading-shade",4,"ngIf"],[1,"col-md-8"],["mode","indeterminate"],[3,"click"],["src","assets/img/user.png","alt","Avatar","class","avatar","mat-list-icon","",4,"ngIf"],["src","assets/img/doctor.png","alt","Avatar","class","avatar","mat-list-icon","",4,"ngIf"],["mat-line",""],["src","assets/img/user.png","alt","Avatar","mat-list-icon","",1,"avatar"],["src","assets/img/doctor.png","alt","Avatar","mat-list-icon","",1,"avatar"],[1,"users-loading-shade"],[1,"mb-2"],["src","assets/img/user.png","alt","Avatar","class","avatar-chat","mat-card-avatar","",4,"ngIf"],["src","assets/img/doctor.png","alt","Avatar","class","avatar-chat","mat-card-avatar","",4,"ngIf"],[1,"mb-0"],[1,"w-100","mb-0"],["role","list"],["itemSize","50",1,"viewport","w-100"],["role","listitem",3,"class",4,"cdkVirtualFor","cdkVirtualForOf"],["class","messages-loading-shade",4,"ngIf"],[1,"d-flex","w-100","px-2"],["type","file",1,"d-none",3,"change"],["imageInput",""],["mat-icon-button","","color","primary",1,"my-auto","mr-1",3,"click"],[1,"d-flex","w-100",3,"formGroup","ngSubmit"],[1,"w-100","mr-3"],["type","text","autocomplete","off","matInput","","placeholder","Ej. It makes me feel...","formControlName","message"],["type","submit","mat-mini-fab","","color","primary",1,"my-auto"],["src","assets/img/user.png","alt","Avatar","mat-card-avatar","",1,"avatar-chat"],["src","assets/img/doctor.png","alt","Avatar","mat-card-avatar","",1,"avatar-chat"],["role","listitem"],["mat-mini-fab","","color","warn",3,"click",4,"ngIf"],["mat-mini-fab","","color","warn",3,"click"],[1,"messages-loading-shade"]],template:function(t,e){1&t&&(o.Vb(0,"h1"),o.Qc(1,"Chat"),o.Ub(),o.Oc(2,M,2,0,"p",0),o.Oc(3,O,2,0,"p",0),o.Vb(4,"div",1),o.Vb(5,"div",2),o.Vb(6,"mat-card",3),o.Oc(7,w,1,0,"mat-progress-bar",4),o.Vb(8,"mat-selection-list",5),o.Oc(9,P,5,3,"mat-list-option",6),o.Ub(),o.Oc(10,x,1,0,"div",7),o.Ub(),o.Ub(),o.Vb(11,"div",8),o.Oc(12,$,28,8,"mat-card",0),o.Ub(),o.Ub()),2&t&&(o.Cb(2),o.qc("ngIf","doctor"===e.loggedIn.roles[0]),o.Cb(1),o.qc("ngIf","paciente"===e.loggedIn.roles[0]),o.Cb(4),o.qc("ngIf",e.isLoadingUsers),o.Cb(1),o.qc("multiple",!1),o.Cb(1),o.qc("ngForOf",e.users),o.Cb(1),o.qc("ngIf",e.isLoadingMessages),o.Cb(2),o.qc("ngIf",e.selectedUser))},directives:[a.m,f.a,p.g,a.l,h.a,p.e,v.i,p.b,f.e,f.i,f.h,f.d,p.a,U.e,U.a,U.d,f.b,I.a,C.a,n.v,n.n,n.h,V.b,V.e,y.b,n.c,n.m,n.g,f.c,p.c],styles:[".dot[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%}.dot[_ngcontent-%COMP%], .header-image[_ngcontent-%COMP%]{background-image:url(https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcRBLXh6UTPGZy1H9Oq_UUdhLqh06Ns-SbV6xQ&usqp=CAU);background-size:cover}.viewport[_ngcontent-%COMP%]{height:250px}.item[_ngcontent-%COMP%]{height:50px}.messages-loading-shade[_ngcontent-%COMP%], .users-loading-shade[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;right:0;background:#fff;opacity:.5;z-index:1;display:flex;align-items:center;justify-content:center}.list[_ngcontent-%COMP%]{overflow-y:auto}.avatar[_ngcontent-%COMP%]{width:40px!important;height:40px!important}.avatar[_ngcontent-%COMP%], .avatar-chat[_ngcontent-%COMP%]{vertical-align:middle;border-radius:50%}.avatar-chat[_ngcontent-%COMP%]{width:50px;height:50px}"]}),t})()}];let N=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[i.d.forChild(R)],i.d]}),t})();var B=s("hctd");let D=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[a.c,N,B.a,n.s]]}),t})()},f4AX:function(t,e,s){"use strict";s.d(e,"a",function(){return c});var a=s("AytR"),i=s("fXoL"),n=s("tk/3");let c=(()=>{class t{constructor(t){this.httpClient=t}getPatientsByDoctorId(t){return this.httpClient.get(`${a.a.apiUrl}/pacientes/${t}`)}getDoctorsByPatientId(t){return this.httpClient.get(`${a.a.apiUrl}/doctores/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(i.cc(n.b))},t.\u0275prov=i.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);